# `@particle/fetch-file`

Download a file, report progress, retry when appropriate, and verify integrity of downloaded bits.


## Installation

```shell
npm install @particle/fetch-file --save
```

<!-- private-module-note-start -->

<!-- private-module-note-end -->


```js
const fetchFile = require('@particle/fetch-file');
```


## API
<!-- api-docs-start -->
<a name="module_@particle/fetch-file"></a>

### @particle/fetch-file

* [@particle/fetch-file](#module_@particle/fetch-file)
    * [module.exports(url, destination, [options], state)](#exp_module_@particle/fetch-file--module.exports) ⇒ <code>Promise.&lt;(DowloadedFile\|Error)&gt;</code> ⏏
        * [~DowloadedFile](#module_@particle/fetch-file--module.exports..DowloadedFile) : <code>Object</code>
        * [~Progress](#module_@particle/fetch-file--module.exports..Progress) : <code>Object</code>
        * [~onProgress](#module_@particle/fetch-file--module.exports..onProgress) : <code>function</code>


* * *

<a name="exp_module_@particle/fetch-file--module.exports"></a>

#### module.exports(url, destination, [options], state) ⇒ <code>Promise.&lt;(DowloadedFile\|Error)&gt;</code> ⏏
Tries really, really, really hard to download a file, verifying integrity of
the downloaded bits and optionally reporting progress along the way. Also
supports cancellation.

**Kind**: Exported function  
**Returns**: <code>Promise.&lt;(DowloadedFile\|Error)&gt;</code> - A promise for the downloaded file or
an error  

| Param | Type | Default | Description |
| --- | --- | --- | --- |
| url | <code>string</code> |  | The URL for the file you'd like to download |
| destination | <code>string</code> |  | Path where downloaded bits will be saved |
| [options] | <code>object</code> |  |  |
| [options.signal] | <code>object</code> |  | AbortSignal object as defined in https://dom.spec.whatwg.org/#interface-AbortSignal (optional) |
| [options.headers] | <code>object</code> |  | Request headers as key-value map object (optional) |
| [options.maxRetries] | <code>number</code> | <code>3</code> | How many times to retry before giving up (optional) |
| [options.onProgress] | <code>onProgress</code> |  | Function to call with progess info (optional) |
| [options.interval] | <code>number</code> | <code>100</code> | How often to report progress in milliseconds (optional) |
| [options.algorithm] | <code>string</code> | <code>&quot;sha256&quot;</code> | Algorith to use when verifying checksum - supports whatever node's crypto.createHash() method does (optional) |
| state | <code>InternalState</code> |  |  |

**Example**  
```js
// download a file
const result = await fetchFile(url, tmpFile.path);

// download a file and report progress
const onProgress = (progress) => console.log(progress);
const result = await fetchFile(url, tmpFile.path, { onProgress, interval: 250 });

// download a file but don't retry if the first attempt fails
const result = await fetchFile(url, tmpFile.path, { maxRetries: 0 });

// cancel downloading a file
const { AbortController } = fetchFile;
const controller = new AbortController();

try {
   setTimeout(() => controller.abort(), 50);
   await fetchFile(url, tmpFile.path, { signal });
} catch (error){
   error.type; // 'aborted'
   error.name; // 'AbortError'
   error.message; // 'The user aborted a request.'
}
```

* * *

<a name="module_@particle/fetch-file--module.exports..DowloadedFile"></a>

##### module.exports~DowloadedFile : <code>Object</code>
Info about the downloaded file

**Kind**: inner typedef of [<code>module.exports</code>](#exp_module_@particle/fetch-file--module.exports)  
**Properties**

| Name | Type | Description |
| --- | --- | --- |
| filename | <code>string</code> | Filename of downloaded file |
| hash | <code>string</code> | Checksum for downloaded file |


* * *

<a name="module_@particle/fetch-file--module.exports..Progress"></a>

##### module.exports~Progress : <code>Object</code>
Progress data passed to `onProgress` callback

**Kind**: inner typedef of [<code>module.exports</code>](#exp_module_@particle/fetch-file--module.exports)  
**Properties**

| Name | Type | Description |
| --- | --- | --- |
| length | <code>number</code> | size in bytes of your file |
| transferred | <code>number</code> | bytes processed |
| remaining | <code>number</code> | bytes remaining to be processed |
| percentage | <code>number</code> | percentage of bytes transferred (0-100) |


* * *

<a name="module_@particle/fetch-file--module.exports..onProgress"></a>

##### module.exports~onProgress : <code>function</code>
**Kind**: inner typedef of [<code>module.exports</code>](#exp_module_@particle/fetch-file--module.exports)  

| Param | Type | Description |
| --- | --- | --- |
| progress | <code>Progress</code> | progress info for file |


* * *


<!-- api-docs-end -->

_NOTE: Unfortunately, docs have a nasty habit of falling out of date. When in doubt, check usage in [tests](./src/index.test.js)_


